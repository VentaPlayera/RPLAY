<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPLAY - Venta de Playeras</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .product-card {
            border: 1px solid #ddd;
            transition: transform 0.2s;
            margin-bottom: 20px;
        }
        .product-card:hover {
            transform: translateY(-5px);
        }
        .btn-buy {
            background-color: #ff3366;
            color: white;
            border: none;
        }
        .btn-buy:hover {
            background-color: #e6004b;
            color: white;
        }
        .stock-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            color: white;
            z-index: 10;
        }
        .stock-badge.in-stock { background-color: green; }
        .stock-badge.low-stock { background-color: orange; }
        .stock-badge.out-stock { background-color: red; }

        /* --- CORRECCIÓN REFORZADA: IMAGEN DEL MODAL --- */
        .modal-image {
            object-fit: contain; /* Asegura que la imagen se ajuste sin cortar */
            height: 450px;       /* Altura fija para el contenedor del carrusel */
            width: 100%;         /* Ocupa todo el ancho */
            display: block;      /* Comportamiento de bloque */
            background-color: #f0f0f0; /* Fondo para que se vea si falla la carga */
        }
    </style>
</head>
<body>

    <div class="container my-5">
        
        <div class="d-flex align-items-center justify-content-center mb-5">
            <img src="https://imgur.com/mpCQaZg.jpg" alt="Logo de mi tienda" style="max-width: 250px; height: auto;">
        </div>
        <h1 class="text-center mb-5" style="color: #ff3366;">RPLAY</h1>
        
        <div class="container mb-5" id="manualManagementPanel" style="display:none;">
            <h3 class="text-danger mb-3">Administración de Pedidos Apartados</h3>
            <p class="text-muted small">Haz clic en "Liberar Stock" si el cliente no confirmó el pago (gestión manual de las 24 horas).</p>
            <div id="ordersList" class="p-3 border rounded bg-white">
                <p class="text-center text-secondary" id="noOrdersMessage">No hay pedidos pendientes actualmente.</p>
            </div>
            <hr>
            <button class="btn btn-sm btn-outline-secondary" onclick="resetAllStock()">REINICIAR TODO EL INVENTARIO</button>
            <p class="text-muted small mt-2">
                Para *modificar el stock inicial*, usa la función setStock en la consola (F12).
                <br>Ejemplo: **setStock('PROD_001', 'M', 5)**
            </p>
        </div>
        
        <div class="row" id="product-list">
        </div>
    </div>

    <div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="paymentModalLabel">Detalle y Pago</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div id="productCarousel" class="carousel slide" data-bs-ride="carousel">
                                
                                <div class="carousel-indicators">
                                    <button type="button" data-bs-target="#productCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                                    <button type="button" data-bs-target="#productCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
                                    <button type="button" data-bs-target="#productCarousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
                                </div>

                                <div class="carousel-inner">
                                    <div class="carousel-item active">
                                        <img id="modal-img-front" src="" class="modal-image" alt="Delantera de la Playera">
                                    </div>
                                    <div class="carousel-item">
                                        <img id="modal-img-back" src="" class="modal-image" alt="Espalda de la Playera">
                                    </div>
                                    <div class="carousel-item">
                                        <img id="modal-img-side" src="" class="modal-image" alt="Vista Lateral de la Playera">
                                    </div>
                                </div>
                                <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                </button>
                                <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                </button>
                            </div>
                            </div>

                        <div class="col-md-6">
                            
                            <div id="selection-step">
                                <h4 class="mt-3" id="product-name"></h4>
                                <p class="text-muted" id="product-description"></p>
                                
                                <div class="mb-4">
                                    <h6>Talla:</h6>
                                    <div id="size-options"></div>
                                    <small id="size-status" class="text-secondary mt-2"></small>
                                </div>
                                
                                <div class="mb-4">
                                    <h6>Cantidad de Piezas:</h6>
                                    <input type="number" id="quantityInput" class="form-control" value="1" min="1" max="10" style="width: 100px;">
                                    <small id="quantity-status" class="text-secondary mt-2"></small>
                                </div>
                                
                                <hr>
                                
                                <p>Precio Total: <strong id="total-price" class="text-danger"></strong></p>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" value="" id="halfPaymentCheck" checked>
                                    <label class="form-check-label" for="halfPaymentCheck">Pagar la Mitad Ahora (Apartar)</label>
                                </div>
                                <p>Monto a Pagar Ahora: <strong id="payment-due" style="font-size: 1.4rem; color: green;"></strong></p>
                                <small class="text-muted">El resto se pagará al momento de la entrega el 28 de Noviembre.</small>
                            </div>

                            <div id="payment-step" style="display:none;">
                                <h4 class="mt-3 mb-4">Datos del Comprador y Envío</h4>
                                <p class="alert alert-info small">
                                    Estás comprando <strong id="final-quantity-display">1</strong> pieza(s) talla <strong id="final-size-display"></strong> por <strong id="final-price-display"></strong>.
                                    Llena tus datos para guardar el pedido y ver las instrucciones de pago por transferencia.
                                </p>

                                <div class="mb-3">
                                    <label for="clientName" class="form-label">Nombre Completo (*):</label>
                                    <input type="text" class="form-control" id="clientName" required>
                                </div>
                                <div class="mb-3">
                                    <label for="clientPhone" class="form-label">Teléfono/WhatsApp (*):</label>
                                    <input type="tel" class="form-control" id="clientPhone" required>
                                </div>
                                <div class="mb-3">
                                    <label for="clientAddress" class="form-label">Dirección de Envío Completa (*):</label>
                                    <textarea class="form-control" id="clientAddress" rows="2" required></textarea>
                                </div>
                                
                                <div id="payment-error" class="text-danger mb-3" style="display:none;">Por favor, completa todos los campos requeridos (*).</div>
                            </div>
                            
                            <div id="transfer-info" style="display:none;">
                                <h4 class="mt-3 mb-4 text-success">¡Pedido Generado!</h4>
                                <p>Hola <strong id="client-name-display"></strong>. Para confirmar tu compra de <span id="final-qty-conf">1</span> playera(s) (<span id="final-item-display"></span>, Talla <span id="final-size-conf"></span>), realiza la transferencia por el monto de <strong id="final-amount-conf" class="text-success"></strong> a la siguiente cuenta:</p>
                                <hr>
                                
                                <h5 class="text-primary">Datos de Transferencia Bancaria</h5>
                                <p class="mb-1"><strong>Banco:</strong> BANCOMER (BBVA)</p>
                                <p class="mb-1"><strong>Número de Cuenta:</strong> 0123 4567 8901 2345</p>
                                <p class="mb-1"><strong>CLABE Interbancaria:</strong> 012000000000000000</p>
                                <p class="mb-1"><strong>Beneficiario:</strong> MI TIENDA DE PLAYERAS S.A. DE C.V.</p>
                                
                                <hr>
                                <p class="text-center">¡Haz clic en el botón de WhatsApp abajo para enviar tus datos y el comprobante!</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <a href="#" target="_blank" class="btn btn-success" id="whatsapp-confirm-button" style="display:none;">
                        Enviar Comprobante por WhatsApp
                    </a>
                    
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="modal-close-button">Cerrar</button>
                    
                    <button type="button" class="btn btn-buy" id="modal-main-button" disabled>Pagar Ahora</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        
        // --- 1. GENERACIÓN DINÁMICA DE INVENTARIO INICIAL (70 Productos) ---
        const productInventory = {};
        const productData = [];
        const DEFAULT_GLOBAL_SIZES = ["M", "L", "XL"]; 
        const FIXED_PRICE = 250.00; 
        const DEFAULT_STOCK_PER_SIZE = 1;
        const PRODUCT_LIST_CONTAINER = document.getElementById('product-list');

        function generateInitialInventory() {
            for (let i = 1; i <= 70; i++) {
                const id = `PROD_${String(i).padStart(3, '0')}`;
                let mainImg, frontImg, backImg, sideImg; 
                let modelSizes = [...DEFAULT_GLOBAL_SIZES]; 
                let initialStockOverrides = {}; 
                
                // Imágenes por defecto
                mainImg = `https://via.placeholder.com/250x250/F4E3F5?text=Modelo+${i}`;
                frontImg = `https://via.placeholder.com/500x500/F4E3F5?text=Frente+${i}`;
                backImg = `https://via.placeholder.com/500x500/F4E3F5?text=Espalda+${i}`;
                sideImg = `https://via.placeholder.com/500x500/E3F5F4?text=Lateral+${i}`; 

                // ==========================================================
                // INICIO DE ASIGNACIÓN DE RUTAS DE IMAGEN ÚNICAS
                // ==========================================================
                
                if (i === 1) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Xime1.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Xime1.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Xime2.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/blanco.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 2) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Xime3.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Xime3.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Xime4.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/negro.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 3) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Lucy1.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Lucy1.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Lucy2.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/blanco.png'; 
                    modelSizes = ['M','XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.XL=1;
                } else if (i === 4) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Lucy3.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Lucy3.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Lucy4.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/negro.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=2;
                } else if (i === 5) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Raul1.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Raul1.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Raul2.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/negro.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 6) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Raul3.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Raul3.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Raul4.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/negro.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 7) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Abi1.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Abi1.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Abi2.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/blanco.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 8) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Abi3.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Abi3.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Abi4.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/negro.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 9) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Dani1.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Dani1.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Dani2.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/blanco.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 10) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Dani3.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Dani3.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Dani4.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/negro.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 11) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Dali1.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Dali1.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Dali2.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/negro.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 12) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Dali3.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Dali3.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Dali4.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/negro.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 13) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Yose1.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Yose1.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Yose2.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/negro.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 14) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Yose3.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Yose3.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Yose4.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/negro.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 15) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Keila1.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Keila1.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Keila2.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/blanco.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 16) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Keila3.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Keila3.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Keila4.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/negro.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 17) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Kenji1.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Kenji1.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Kenji2.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/negro.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 18) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Kenji3.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Kenji3.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Kenji4.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/negro.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 19) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Alli1.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Alli1.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Alli2.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/negro.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 20) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Alli3.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Alli3.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Alli4.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/negro.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 21) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Ale1.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Ale1.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Ale2.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/arena.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 22) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Ale3.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Ale3.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Ale4.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/arena.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 23) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Miri1.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Miri1.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Miri2.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/negro.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 24) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Miri3.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Miri3.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Miri4.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/negro.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 25) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Didi1.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Didi1.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Didi2.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/negro.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 26) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Didi3.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Didi3.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Didi4.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/arena.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 27) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Vale1.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Vale1.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Vale2.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/arena.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 28) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Vale3.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Vale3.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Vale4.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/negro.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 29) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Caro1.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Caro1.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Caro2.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/negro.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 30) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Caro3.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Caro3.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Caro4.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/negro.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 31) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Katy1.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/katy1.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Katy2.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/negro.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } else if (i === 32) { 
                    mainImg = 'https://ventaplayera.github.io/RPLAY/Katy3.png'; 
                    frontImg = 'https://ventaplayera.github.io/RPLAY/Katy3.png';
                    backImg = 'https://ventaplayera.github.io/RPLAY/Katy4.png';
                    sideImg = 'https://ventaplayera.github.io/RPLAY/blanco.png'; 
                    modelSizes = ['M', 'L', 'XL'];
                    initialStockOverrides.M = 1; 
                    initialStockOverrides.L=1;
                    initialStockOverrides.XL=1;
                } 
                // 1. Crear el objeto de stock para este producto
                const stock = {};
                modelSizes.forEach(size => {
                    stock[size] = initialStockOverrides[size] !== undefined ? initialStockOverrides[size] : DEFAULT_STOCK_PER_SIZE;
                });
                // 2. Asignar al inventario global
                productInventory[id] = stock;
                // 3. Añadir a la lista de productos
                productData.push({
                    id: id,
                    name: `Playera Modelo No. ${i}`,
                    price: FIXED_PRICE.toFixed(2), 
                    description: `Diseño exclusivo #${i} con estampado digital de alta calidad. Tela de algodón 100%.`,
                    img_main: mainImg,
                    img_front: frontImg,
                    img_back: backImg,
                    img_side: sideImg 
                });
            }
        }


        // --- 2. GESTIÓN DE STOCK Y ESTADO ---
        let currentProductID = null;
        let currentProductSize = null;
        let currentQuantity = 1;
        let currentPrice = 0;
        let currentProductName = '';
        
        // La función setStock se mantiene para uso en consola si es necesario, aunque el panel esté oculto
        function setStock(id, size, count) {
            if (productInventory[id] && productInventory[id][size] !== undefined) {
                productInventory[id][size] = count;
                updateProductBadge(id);
                if (currentProductID === id && currentProductSize === size) {
                    updateQuantityStatus();
                }
            }
        }

        function getStock(id, size) {
            return productInventory[id] && productInventory[id][size] !== undefined ? productInventory[id][size] : 0;
        }

        function updateProductBadge(id) {
            const stockElement = document.getElementById(`badge-${id}`);
            if (!stockElement) return;

            const sizes = Object.keys(productInventory[id] || {});
            let totalStock = sizes.reduce((sum, size) => sum + getStock(id, size), 0);

            // CAMBIO AQUÍ: "preventa" en lugar de "en stock"
            stockElement.textContent = totalStock > 0 ? `preventa` : 'Agotado'; // Solo dice "preventa" si hay stock
            stockElement.className = 'stock-badge';
            if (totalStock > 0) { // Cualquier stock > 0 se considera "preventa"
                stockElement.classList.add('in-stock'); // Se mantiene el color verde para "preventa"
            } else {
                stockElement.classList.add('out-stock');
            }
        }
        
        // --- 3. RENDERIZADO DE LA INTERFAZ ---

        function renderProductCards() {
            let html = '';
            productData.forEach(product => {
                html += `
                    <div class="col-lg-3 col-md-4 col-sm-6 d-flex">
                        <div class="card product-card flex-fill" data-product-id="${product.id}">
                            <span class="stock-badge" id="badge-${product.id}"></span> 
                            <img src="${product.img_main}" class="card-img-top" alt="Playera ${product.name}">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">${product.name}</h5>
                                <p class="card-text text-muted">${product.description.substring(0, 50)}...</p>
                                <div class="mt-auto">
                                    <p class="price mb-2">$${product.price} MXN</p>
                                    <button 
                                        class="btn btn-block btn-buy w-100" 
                                        data-bs-toggle="modal" 
                                        data-bs-target="#paymentModal" 
                                        data-product-id="${product.id}"
                                        data-price="${product.price}" 
                                        data-name="${product.name}"
                                        data-description="${product.description}"
                                        data-img-front="${product.img_front}" 
                                        data-img-back="${product.img_back}"
                                        data-img-side="${product.img_side}">
                                        Ver Detalle y Comprar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            PRODUCT_LIST_CONTAINER.innerHTML = html;
            productData.forEach(product => updateProductBadge(product.id)); 
        }


        // --- 4. GESTIÓN DEL MODAL ---

        const paymentModal = document.getElementById('paymentModal');
        const quantityInput = document.getElementById('quantityInput');
        const halfPaymentCheck = document.getElementById('halfPaymentCheck');
        const modalMainButton = document.getElementById('modal-main-button');

        // Función para crear botones de talla
        function createSizeButtons(id) {
            const sizeOptions = document.getElementById('size-options');
            sizeOptions.innerHTML = '';
            
            if (!productInventory[id]) return;

            Object.keys(productInventory[id]).forEach(size => {
                const stock = getStock(id, size);
                const button = document.createElement('button');
                button.type = 'button';
                button.className = 'btn btn-outline-secondary me-2 mb-2';
                button.textContent = size;
                button.setAttribute('data-size', size);
                
                if (stock <= 0) {
                    button.disabled = true;
                    button.classList.add('text-danger');
                    button.title = 'Agotado';
                }

                button.addEventListener('click', () => {
                    currentProductSize = size;
                    document.querySelectorAll('#size-options button').forEach(btn => {
                        btn.classList.remove('active', 'btn-danger');
                        btn.classList.add('btn-outline-secondary');
                    });
                    button.classList.add('active', 'btn-danger');
                    button.classList.remove('btn-outline-secondary');
                    updateQuantityStatus();
                    checkModalButtonState();
                });
                sizeOptions.appendChild(button);
            });
        }

        // Función para actualizar el estado del stock de la cantidad
        function updateQuantityStatus() {
            const statusElement = document.getElementById('quantity-status');
            const stock = getStock(currentProductID, currentProductSize);
            currentQuantity = parseInt(quantityInput.value);

            if (!currentProductSize) {
                statusElement.textContent = "Selecciona una talla.";
                modalMainButton.disabled = true;
                return;
            }

            if (currentQuantity > stock) {
                statusElement.textContent = `Solo quedan ${stock} piezas en talla ${currentProductSize}.`;
                statusElement.classList.remove('text-secondary');
                statusElement.classList.add('text-danger');
                quantityInput.max = stock;
                if (currentQuantity > stock) quantityInput.value = stock; 
                currentQuantity = parseInt(quantityInput.value);
            } else if (stock > 0) {
                statusElement.textContent = `Disponible para preventa: ${stock}.`; // CAMBIO AQUÍ
                statusElement.classList.remove('text-danger');
                statusElement.classList.add('text-secondary');
                quantityInput.max = 10; 
            } else {
                statusElement.textContent = `Agotado en talla ${currentProductSize}.`;
                statusElement.classList.remove('text-secondary');
                statusElement.classList.add('text-danger');
            }
            checkModalButtonState();
        }

        // Función para actualizar los precios
        function updatePriceDisplays() {
            const isHalfPayment = halfPaymentCheck.checked;
            const total = currentPrice * currentQuantity;
            const paymentDue = isHalfPayment ? total / 2 : total;

            document.getElementById('total-price').textContent = `$${total.toFixed(2)} MXN`;
            document.getElementById('payment-due').textContent = `$${paymentDue.toFixed(2)} MXN`;
        }

        // Función para verificar si el botón de "Pagar Ahora" debe estar activo
        function checkModalButtonState() {
            const stock = getStock(currentProductID, currentProductSize);
            const canProceed = currentProductSize !== null && currentQuantity > 0 && stock >= currentQuantity;
            modalMainButton.disabled = !canProceed;
        }

        // Eventos en el Modal
        paymentModal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget;
            
            // 1. Cargar datos del producto
            currentProductID = button.getAttribute('data-product-id');
            currentProductName = button.getAttribute('data-name');
            currentPrice = parseFloat(button.getAttribute('data-price')); 
            
            document.getElementById('product-name').textContent = currentProductName;
            document.getElementById('product-description').textContent = button.getAttribute('data-description');
            
            // Carga de las tres imágenes
            document.getElementById('modal-img-front').src = button.getAttribute('data-img-front');
            document.getElementById('modal-img-back').src = button.getAttribute('data-img-back');
            document.getElementById('modal-img-side').src = button.getAttribute('data-img-side'); 

            // 2. Resetear la vista y generar botones
            resetModalView();
            createSizeButtons(currentProductID);
            updatePriceDisplays();

            // Mensaje de depuración de imágenes (mantengo por si hay problemas de carga de URLs)
            console.log("--- DEBUG DE IMAGEN ---");
            console.log("URL Frente:", button.getAttribute('data-img-front'));
            console.log("URL Espalda:", button.getAttribute('data-img-back'));
            console.log("URL Lateral:", button.getAttribute('data-img-side'));
            console.log("-----------------------");
        });

        quantityInput.addEventListener('input', () => {
            if (currentProductID) {
                updateQuantityStatus();
                updatePriceDisplays();
            }
        });

        halfPaymentCheck.addEventListener('change', updatePriceDisplays);


        // --- 5. LÓGICA DE FLUJO DE COMPRA ---

        modalMainButton.addEventListener('click', () => {
            if (modalMainButton.textContent === 'Pagar Ahora') {
                // Paso 1: Pasar a la captura de datos
                document.getElementById('selection-step').style.display = 'none';
                document.getElementById('payment-step').style.display = 'block';

                // Mostrar resumen
                const total = currentPrice * currentQuantity;
                const paymentDue = halfPaymentCheck.checked ? total / 2 : total;

                document.getElementById('final-quantity-display').textContent = currentQuantity;
                document.getElementById('final-size-display').textContent = currentProductSize;
                document.getElementById('final-price-display').textContent = `$${paymentDue.toFixed(2)} MXN`;
                
                modalMainButton.textContent = 'Confirmar Pedido';
                modalMainButton.disabled = false; 

            } else if (modalMainButton.textContent === 'Confirmar Pedido') {
                // Paso 2: Validar datos y generar orden

                const name = document.getElementById('clientName').value.trim();
                const phone = document.getElementById('clientPhone').value.trim();
                const address = document.getElementById('clientAddress').value.trim();

                if (name === '' || phone === '' || address === '') {
                    document.getElementById('payment-error').style.display = 'block';
                    return;
                }
                document.getElementById('payment-error').style.display = 'none';

                // Generar Pedido (Lógica de inventario)
                generateOrder(name, phone, address);
            }
        });


        // --- 6. GESTIÓN DE ORDEN E INVENTARIO PERSISTENTE ---
        const PENDING_ORDERS = JSON.parse(localStorage.getItem('RPLAY_PENDING_ORDERS')) || [];
        const INVENTORY_STORAGE = JSON.parse(localStorage.getItem('RPLAY_INVENTORY')) || {};

        function loadInventoryStorage() {
             Object.keys(INVENTORY_STORAGE).forEach(productId => {
                if (productInventory[productId]) {
                    Object.keys(INVENTORY_STORAGE[productId]).forEach(size => {
                        productInventory[productId][size] = INVENTORY_STORAGE[productId][size];
                    });
                }
            });
        }


        function generateOrder(name, phone, address) {
            const orderID = Date.now();
            const total = currentPrice * currentQuantity;
            const paymentDue = halfPaymentCheck.checked ? total / 2 : total;

            const order = {
                id: orderID,
                productID: currentProductID,
                productName: currentProductName,
                size: currentProductSize,
                quantity: currentQuantity,
                totalPrice: total,
                paymentDue: paymentDue,
                isHalfPayment: halfPaymentCheck.checked,
                clientName: name,
                clientPhone: phone,
                clientAddress: address,
                timestamp: Date.now(),
                expiration: Date.now() + (24 * 60 * 60 * 1000) 
            };

            // 1. Descontar stock del inventario global
            productInventory[order.productID][order.size] -= order.quantity;
            localStorage.setItem('RPLAY_INVENTORY', JSON.stringify(productInventory));
            updateProductBadge(order.productID);
            
            // 2. Guardar la orden pendiente
            PENDING_ORDERS.push(order);
            localStorage.setItem('RPLAY_PENDING_ORDERS', JSON.stringify(PENDING_ORDERS));

            // 3. Mostrar info de transferencia y WhatsApp
            showTransferInfo(order);
        }

        function showTransferInfo(order) {
            document.getElementById('payment-step').style.display = 'none';
            document.getElementById('transfer-info').style.display = 'block';

            document.getElementById('client-name-display').textContent = order.clientName;
            document.getElementById('final-item-display').textContent = order.productName;
            document.getElementById('final-qty-conf').textContent = order.quantity;
            document.getElementById('final-size-conf').textContent = order.size;
            document.getElementById('final-amount-conf').textContent = `$${order.paymentDue.toFixed(2)} MXN`;

            // Botón de WhatsApp
            const message = `¡Hola! Acabo de generar un pedido de playeras RPLAY (#${order.id}).\n\n- Producto: ${order.productName}\n- Talla: ${order.size}\n- Cantidad: ${order.quantity}\n- Monto pagado/apartado: $${order.paymentDue.toFixed(2)} MXN.\n- Mi nombre es: ${order.clientName}\n- Mi dirección es: ${order.clientAddress}`;
            
            // IMPORTANTE: REEMPLAZA EL NÚMERO GENÉRICO CON EL TUYO (ej: 5218123456789)
            const whatsappUrl = `https://api.whatsapp.com/send?phone=521XXXXXXXXXX&text=${encodeURIComponent(message)}`;
            document.getElementById('whatsapp-confirm-button').href = whatsappUrl;
            document.getElementById('whatsapp-confirm-button').style.display = 'block';
            modalMainButton.style.display = 'none';
            document.getElementById('modal-close-button').textContent = 'Listo';

            // Actualizar panel de administración (Aunque el panel esté oculto, esta función puede usarse si se decide mostrarlo en el futuro)
            renderOrdersList();
        }

        // --- 7. FUNCIONES DE UTILIDAD Y ADMINISTRACIÓN ---

        // Esta función se mantiene, pero solo se llama si el panel de administración fuera visible.
        function renderOrdersList() {
            const list = document.getElementById('ordersList');
            const noOrdersMessage = document.getElementById('noOrdersMessage');
            if (!list || !noOrdersMessage) return; // Asegura que los elementos existan si el panel se oculta completamente

            list.innerHTML = '';
            
            if (PENDING_ORDERS.length === 0) {
                noOrdersMessage.style.display = 'block';
                return;
            }
            noOrdersMessage.style.display = 'none';

            PENDING_ORDERS.forEach(order => {
                const elapsedHours = ((Date.now() - order.timestamp) / 3600000).toFixed(1);
                const expired = Date.now() > order.expiration;
                const cardClass = expired ? 'border-danger' : 'border-warning';
                
                list.innerHTML += `
                    <div class="card mb-2 ${cardClass}">
                        <div class="card-body p-2">
                            <p class="mb-1">
                                **Pedido #${order.id}** (${order.productName} T: ${order.size} x${order.quantity}) - Pagó: $${order.paymentDue.toFixed(2)} MXN
                            </p>
                            <p class="mb-1 small text-muted">Cliente: ${order.clientName} | Tel: ${order.clientPhone}</p>
                            <p class="mb-1 small text-danger ${expired ? 'fw-bold' : ''}">
                                Apartado hace ${elapsedHours} hrs. ${expired ? '(¡EXPIRADO!)' : ''}
                            </p>
                            <button class="btn btn-sm btn-outline-danger mt-1" onclick="releaseStock(${order.id}, '${order.productID}', '${order.size}', ${order.quantity})">
                                Liberar Stock
                            </button>
                        </div>
                    </div>
                `;
            });
        }

        // Estas funciones se mantienen como "window.fucntionName" para que puedan ser ejecutadas desde la consola del navegador (F12)
        // si un administrador necesita interactuar con ellas manualmente, a pesar de que el panel visual esté oculto.
        window.releaseStock = (orderId, productId, size, quantity) => {
             // 1. Devolver el stock
            if (productInventory[productId] && productInventory[productId][size] !== undefined) {
                productInventory[productId][size] += quantity;
                localStorage.setItem('RPLAY_INVENTORY', JSON.stringify(productInventory));
                updateProductBadge(productId);
            }
           
            // 2. Remover la orden
            const index = PENDING_ORDERS.findIndex(order => order.id === orderId);
            if (index > -1) {
                PENDING_ORDERS.splice(index, 1);
                localStorage.setItem('RPLAY_PENDING_ORDERS', JSON.stringify(PENDING_ORDERS));
            }
            // 3. Re-renderizar (esto afectaría al panel si estuviera visible)
            renderOrdersList(); 
            renderProductCards(); 
        }

        window.resetAllStock = () => {
            if (confirm("ADVERTENCIA: ¿Estás seguro de que quieres REINICIAR TODO EL INVENTARIO A SU ESTADO INICIAL? Esto borra el stock y todas las órdenes pendientes.")) {
                localStorage.removeItem('RPLAY_INVENTORY');
                localStorage.removeItem('RPLAY_PENDING_ORDERS');
                window.location.reload();
            }
        }

        window.setStock = (id, size, count) => {
            setStock(id, size, count);
        }

        function resetModalView() {
            // Reiniciar vistas del modal
            document.getElementById('selection-step').style.display = 'block';
            document.getElementById('payment-step').style.display = 'none';
            document.getElementById('transfer-info').style.display = 'none';
            document.getElementById('payment-error').style.display = 'none';

            // Reiniciar inputs
            document.getElementById('clientName').value = '';
            document.getElementById('clientPhone').value = '';
            document.getElementById('clientAddress').value = '';
            quantityInput.value = 1;

            // Reiniciar estado interno
            currentProductSize = null;
            currentQuantity = 1;
            modalMainButton.textContent = 'Pagar Ahora';
            modalMainButton.disabled = true;
            document.getElementById('whatsapp-confirm-button').style.display = 'none';
            modalMainButton.style.display = 'block';
            document.getElementById('modal-close-button').textContent = 'Cerrar';

            // Reiniciar carrusel a la primera imagen
            const carouselElement = document.getElementById('productCarousel');
            if (carouselElement) {
                const carousel = bootstrap.Carousel.getOrCreateInstance(carouselElement);
                carousel.to(0);
            }
        }
        
        // --- INICIALIZACIÓN ---
        document.addEventListener('DOMContentLoaded', () => {
            generateInitialInventory();
            loadInventoryStorage();
            // No llamamos a renderOrdersList() aquí si el panel está oculto por defecto,
            // solo se llamaría si el panel se hace visible dinámicamente o si es estrictamente necesario para la lógica interna.
            renderProductCards();
        });

    </script>
</body>
</html>








