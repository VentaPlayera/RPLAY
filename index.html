<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPLAY </title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" type='image/png' href="https://ventaplayera.github.io/RPLAY/logo.png">
    <style>
        /* Estilos Generales */
        <body { background-color: #f7f7f7; }
        .price { font-size: 1.5rem; font-weight: 700; color: #ff3366; }
        .btn-buy { background-color: #ff3366; color: white; border: none; transition: background-color 0.3s; }
        .btn-buy:hover { background-color: #e6004c; color: white; }
        
        /* Estilos de las Tarjetas de Producto */
        .product-card {
            border: none; border-radius: 12px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease; margin-bottom: 25px; overflow: hidden; background-color: white;
            position: relative; 
        }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2); }
        /* Imagen de producto adaptada a m√≥viles */
        .product-card img { 
            height: 250px; 
            object-fit: contain;
            background-color: #f0f0f0;
            border-top-left-radius: 12px; 
            border-top-right-radius: 12px; 
            width: 100%; /* Asegura que la imagen ocupe el ancho completo */
        }

        /* Estilos del Badge de Stock */
        .stock-badge {
            position: absolute; top: 10px; right: 10px;
            padding: 5px 10px; border-radius: 5px;
            font-weight: 700; font-size: 0.85rem;
            z-index: 10;
        }
        .stock-badge.agotado { background-color: #6c757d; color: white; } 
        .stock-badge.ultima { background-color: #ffc107; color: #343a40; } 

        /* Estilos para los Botones de Talla */
        .size-btn {
            border: 1px solid #ccc; padding: 5px 15px; margin-right: 5px; cursor: pointer;
            border-radius: 5px; transition: all 0.2s; background-color: white; display: inline-block;
        }
        .size-btn:hover:not(.selected):not(.disabled) { border-color: #ff3366; color: #ff3366; }
        .size-btn.selected { background-color: #ff3366; color: white; border-color: #ff3366; }
        .size-btn.disabled {
            background-color: #f7f7f7; color: #ccc; text-decoration: line-through;
            cursor: not-allowed; border-color: #f7f7f7;
        }
        
        /* Ajustes para el Modal de Detalle en m√≥viles */
        @media (max-width: 767.98px) {
            .modal-body .row > div {
                margin-bottom: 15px;
            }
        }

        /* üîí OCULTAR PANELES DE ADMINISTRACI√ìN POR DEFECTO üîí */
        #manualManagementPanel { display: none; } 
    </style>
</head>
<body>

    <div class="container my-5">
        
        <div class="d-flex align-items-center justify-content-center mb-5">
              <div class="d-flex align-items-center justify-content-center mb-5">
    <img src="https://imgur.com/mpCQaZg.jpg" alt="Logo de mi tienda" style="max-width: 250px; height: auto;">
</div>
            <h1 style="color: #ff3366; margin: 0;"> <link rel="icon" type="logo.png" href='logo.png'>RPLAY</h1>
        </div>
        
        <div class="container mb-5" id="manualManagementPanel">
            <h3 class="text-danger mb-3">Administraci√≥n de Pedidos Apartados</h3>
            <p class="text-muted small">Haz clic en "Liberar Stock" si el cliente no confirm√≥ el pago (gesti√≥n manual de las 24 horas).</p>
            <div id="ordersList" class="p-3 border rounded bg-white">
                <p class="text-center text-secondary" id="noOrdersMessage">No hay pedidos pendientes actualmente.</p>
            </div>
            <hr>
            <button class="btn btn-sm btn-outline-secondary" onclick="resetAllStock()">REINICIAR TODO EL INVENTARIO</button>
            <p class="text-muted small mt-2">
                Para *modificar el stock inicial*, usa la funci√≥n setStock en la consola (F12).
                <br>Ejemplo: **setStock('PROD_001', 'M', 5)**
            </p>
        </div>
        
        <div class="row" id="product-list">
            </div>
    </div>

    <div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="paymentModalLabel">Detalle y Pago</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div id="productCarousel" class="carousel slide" data-bs-ride="carousel">
                                <div class="carousel-inner">
                                    <div class="carousel-item active">
                                        <img id="modal-img-front" src="" class="d-block w-100" alt="Delantera de la Playera">
                                    </div>
                                    <div class="carousel-item">
                                        <img id="modal-img-back" src="" class="d-block w-100" alt="Espalda de la Playera">
                                    </div>
                                </div>
                                <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                </button>
                                <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                </button>
                            </div>
                        </div>

                        <div class="col-md-6">
                            
                            <div id="selection-step">
                                <h4 class="mt-3" id="product-name"></h4>
                                <p class="text-muted" id="product-description"></p>
                                
                                <div class="mb-4">
                                    <h6>Talla:</h6>
                                    <div id="size-options"></div>
                                    <small id="size-status" class="text-secondary mt-2"></small>
                                </div>
                                
                                <div class="mb-4">
                                    <h6>Cantidad de Piezas:</h6>
                                    <input type="number" id="quantityInput" class="form-control" value="1" min="1" max="10" style="width: 100px;">
                                    <small id="quantity-status" class="text-secondary mt-2"></small>
                                </div>
                                
                                <hr>
                                
                                <p>Precio Total: <strong id="total-price" class="text-danger"></strong></p>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" value="" id="halfPaymentCheck" checked>
                                    <label class="form-check-label" for="halfPaymentCheck">Pagar la Mitad Ahora (Apartar)</label>
                                </div>
                                <p>Monto a Pagar Ahora: <strong id="payment-due" style="font-size: 1.4rem; color: green;"></strong></p>
                                <small class="text-muted">El resto se pagar√° al momento de la entrega el 28 de Noviembre.</small>
                            </div>

                            <div id="payment-step" style="display:none;">
                                <h4 class="mt-3 mb-4">Datos del Comprador y Env√≠o</h4>
                                <p class="alert alert-info small">
                                    Est√°s comprando <strong id="final-quantity-display">1</strong> pieza(s) talla <strong id="final-size-display"></strong> por <strong id="final-price-display"></strong>.
                                    Llena tus datos para guardar el pedido y ver las instrucciones de pago por transferencia.
                                </p>

                                <div class="mb-3">
                                    <label for="clientName" class="form-label">Nombre Completo (*):</label>
                                    <input type="text" class="form-control" id="clientName" required>
                                </div>
                                <div class="mb-3">
                                    <label for="clientPhone" class="form-label">Tel√©fono/WhatsApp (*):</label>
                                    <input type="tel" class="form-control" id="clientPhone" required>
                                </div>
                                <div class="mb-3">
                                    <label for="clientAddress" class="form-label">Direcci√≥n de Env√≠o Completa (*):</label>
                                    <textarea class="form-control" id="clientAddress" rows="2" required></textarea>
                                </div>
                                
                                <div id="payment-error" class="text-danger mb-3" style="display:none;">Por favor, completa todos los campos requeridos (*).</div>
                            </div>
                            
                            <div id="transfer-info" style="display:none;">
                                <h4 class="mt-3 mb-4 text-success">¬°Pedido Generado!</h4>
                                <p>Hola <strong id="client-name-display"></strong>. Para confirmar tu compra de <span id="final-qty-conf">1</span> playera(s) (<span id="final-item-display"></span>, Talla <span id="final-size-conf"></span>), realiza la transferencia por el monto de <strong id="final-amount-conf" class="text-success"></strong> a la siguiente cuenta:</p>
                                <hr>
                                
                                <h5 class="text-primary">Datos de Transferencia Bancaria</h5>
                                <p class="mb-1"><strong>Banco:</strong> BANCOMER (BBVA)</p>
                                <p class="mb-1"><strong>N√∫mero de Cuenta:</strong> 0123 4567 8901 2345</p>
                                <p class="mb-1"><strong>CLABE Interbancaria:</strong> 012000000000000000</p>
                                <p class="mb-1"><strong>Beneficiario:</strong> MI TIENDA DE PLAYERAS S.A. DE C.V.</p>
                                
                                <hr>
                                <p class="text-center">¬°Haz clic en el bot√≥n de WhatsApp abajo para enviar tus datos y el comprobante!</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <a href="#" target="_blank" class="btn btn-success" id="whatsapp-confirm-button" style="display:none;">
                        Enviar Comprobante por WhatsApp
                    </a>
                    
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="modal-close-button">Cerrar</button>
                    
                    <button type="button" class="btn btn-buy" id="modal-main-button" disabled>Pagar Ahora</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        
        // --- 1. GENERACI√ìN DIN√ÅMICA DE INVENTARIO INICIAL (70 Productos) ---
        const productInventory = {};
        const productData = [];
        const DEFAULT_GLOBAL_SIZES = ["M", "L", "XL"]; // Tallas por defecto si no se especifican
        const FIXED_PRICE = 250.00; 
        const DEFAULT_STOCK_PER_SIZE = 1;

        for (let i = 1; i <= 70; i++) {
            // CORRECCI√ìN DE SINTAXIS: Usar template literal
            const id = `PROD_${String(i).padStart(3, '0')}`;
            let mainImg, frontImg, backImg;
            let modelSizes = [...DEFAULT_GLOBAL_SIZES]; 
            let initialStockOverrides = {}; // Stock espec√≠fico para este modelo/talla
            
          
            // ==========================================================
            // INICIO DE ASIGNACI√ìN DE RUTAS DE IMAGEN √öNICAS
            // ==========================================================
            // Se han reescrito los bloques para usar el ID del producto
            if (i === 1) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Xime1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Xime1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Xime2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 2) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Xime3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Xime3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Xime4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 3) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Lucy1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Lucy1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Lucy2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 4) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Lucy3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Lucy3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Lucy4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 5) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Raul1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Raul1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Raul2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 6) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Raul3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Raul3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Raul4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 7) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Abi1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Abi1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Abi2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 8) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Abi3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Abi3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Abi4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 9) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Dani1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Dani1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Dani2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 10) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Dani3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Dani3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Dani4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 11) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Dali1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Dali1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Dali2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 12) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Dali3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Dali3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Dali4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 13) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Yose1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Yose1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Yose2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 14) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Yose3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Yose3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Yose4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 15) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Keila1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Keila1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Keila2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 16) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Keila3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Keila3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Keila4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 17) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Kenji1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Kenji1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Kenji2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 18) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Kenji3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Kenji3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Kenji4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 19) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Alli1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Alli1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Alli2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 20) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Alli3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Alli3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Alli4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 21) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Ale1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Ale1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Ale2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 22) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Ale3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Ale3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Ale4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 23) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Miri1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Miri1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Miri2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 24) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Miri3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Miri3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Miri4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 25) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Didi1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Didi1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Didi2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 26) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Didi3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Didi3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Didi4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 27) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Vale1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Vale1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Vale2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 28) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Vale3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Vale3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Vale4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 29) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Caro1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Caro1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Caro2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 30) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Caro3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Caro3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Caro4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } 
            // Para los modelos 21 al 70, se usa una imagen y stock por defecto
            // Las im√°genes predeterminadas se asignan al inicio del loop
            
            // 1. Crear el objeto de stock para este producto
            const stock = {};
            modelSizes.forEach(size => {
                // Usa el override si existe, de lo contrario, usa el stock por defecto
                stock[size] = initialStockOverrides[size] !== undefined ? initialStockOverrides[size] : DEFAULT_STOCK_PER_SIZE;
            });
            // ==========================================================
            // 2. Asignar al inventario global
            productInventory[id] = stock;
            // 3. A√±adir a la lista de productos
            // CORRECCI√ìN DE SINTAXIS: Usar template literals
            productData.push({
                id: id,
                name: `Playera Modelo No. ${i}`,
                price: FIXED_PRICE.toFixed(2), 
                description: `Dise√±o exclusivo #${i} con estampado digital de alta calidad. Tela de algod√≥n 100%.`,
                img_main: mainImg,
                img_front: frontImg,
                img_back: backImg
            });
        }
        
        // --- 2. INVENTARIO PERSISTENTE (Pedidos Ya Confirmados) ---
        // Carga los pedidos guardados para persistencia
        let localOrders = JSON.parse(localStorage.getItem('simulatedOrders')) || {};
        
        // --- 3. L√≥gica del Sistema ---

        document.addEventListener('DOMContentLoaded', function () {
            
            // --- REFERENCIAS A ELEMENTOS HTML ---
            const productListContainer = document.getElementById('product-list');
            const paymentModal = document.getElementById('paymentModal');
            const selectionStep = document.getElementById('selection-step');
            const paymentStep = document.getElementById('payment-step');
            const transferInfo = document.getElementById('transfer-info');
            const sizeOptionsContainer = document.getElementById('size-options');
            const halfPaymentCheck = document.getElementById('halfPaymentCheck');
            const clientNameInput = document.getElementById('clientName');
            const clientPhoneInput = document.getElementById('clientPhone');
            const clientAddressInput = document.getElementById('clientAddress');
            const mainButton = document.getElementById('modal-main-button');
            const whatsappButton = document.getElementById('whatsapp-confirm-button'); 
            const ordersList = document.getElementById('ordersList'); 
            const sizeStatusEl = document.getElementById('size-status'); 
            // REFERENCIAS PARA CANTIDAD
            const quantityInput = document.getElementById('quantityInput');
            const quantityStatusEl = document.getElementById('quantity-status');
            const paymentError = document.getElementById('payment-error');
            
            // üîí ELEMENTOS DE ADMINISTRACI√ìN OCULTOS
            const managementPanel = document.getElementById('manualManagementPanel');

            // Variables de estado
            let currentPrice = FIXED_PRICE; // Se actualiza al abrir el modal
            let currentSelectedSize = null;
            let currentProductName = '';
            let currentProductID = ''; 
            let currentTotalAmount = 0;
            let currentPaymentDue = 0;
            const WHATSAPP_PHONE = "529991480151"; 
            
            // --- Funciones de L√≥gica de Stock/Pedidos ---
            
            function saveLocalOrders() {
                localStorage.setItem('simulatedOrders', JSON.stringify(localOrders));
                if (managementPanel.style.display === 'block') {
                    renderManualManagementPanel(); 
                }
            }

            /**
             * FUNCI√ìN CLAVE: Devuelve el stock real disponible 
             * (Inventario Inicial - Pedidos Apartados)
             */
            function getAvailableStock(productID, size) {
                const stock = productInventory[productID] && productInventory[productID][size] !== undefined ? productInventory[productID][size] : 0;
                // CORRECCI√ìN: Usar template literal para la clave
                const pendingOrders = localOrders[`${productID}-${size}`] ? localOrders[`${productID}-${size}`].quantity : 0; 
                return stock - pendingOrders;
            }
            
            /**
             * FUNCI√ìN CRUCIAL: Modifica el stock INICIAL de un producto/talla 
             * (Para uso externo en la consola F12)
             */
            window.setStock = function(productID, size, newStock) {
                if (productInventory[productID] && productInventory[productID][size] !== undefined) {
                    productInventory[productID][size] = Math.max(0, newStock); 
                    
                    initializeBadges();
                    
                    if (currentProductID === productID) {
                        createSizeButtons(currentProductID);
                        resetModalView();
                    }
                    
                    console.log(`‚úÖ Stock inicial modificado: ${productID}, Talla ${size}. Nuevo Stock: ${productInventory[productID][size]}`);
                    alert(`Stock de ${productID} (Talla ${size}) cambiado a ${newStock}.`);

                } else {
                    console.error(`Error: Producto ID '${productID}' o Talla '${size}' no encontrados.`);
                    alert(`Error: Producto ID '${productID}' o Talla '${size}' no encontrados.`);
                }
            };
            // ----------------------------------------------------

            // FUNCI√ìN: Renderiza los pedidos pendientes en el panel de administraci√≥n
            function renderManualManagementPanel() {
                let orderHtml = '';
                let hasOrders = false;
                
                for (const key in localOrders) {
                    const order = localOrders[key];
                    if (order && order.status === 'pending') {
                        hasOrders = true;
                        orderHtml += `
                            <div class="alert alert-warning d-flex justify-content-between align-items-center mb-2">
                                <div>
                                    <strong>${order.productName} (Talla ${order.size}, Cantidad ${order.quantity})</strong>
                                    <p class="mb-0 small">Cliente: ${order.clientName} | Tel: ${order.clientPhone}</p>
                                    <p class="mb-0 small">Monto Pagado: $${order.paymentDue.toFixed(2)}</p>
                                </div>
                                <button class="btn btn-danger btn-sm" onclick="releaseStock('${key}')">Liberar Stock</button>
                            </div>
                        `;
                    }
                }

                ordersList.innerHTML = orderHtml || '<p class="text-center text-secondary" id="noOrdersMessage">No hay pedidos pendientes actualmente.</p>';
            }

            // FUNCI√ìN: Libera el stock de un pedido pendiente (Admin)
            window.releaseStock = function(orderKey) {
                if (confirm('¬øEst√°s seguro de liberar el stock para este pedido? Esto lo eliminar√° de la lista y el stock volver√° a estar disponible.')) {
                    delete localOrders[orderKey];
                    saveLocalOrders();
                    initializeBadges();
                    if (currentProductID) createSizeButtons(currentProductID); // Refresca si el modal est√° abierto
                }
            }

            // FUNCI√ìN: Reinicia todo el inventario (Admin)
            window.resetAllStock = function() {
                if (confirm('ADVERTENCIA: ¬øEst√°s seguro de REINICIAR TODO EL INVENTARIO? Esto eliminar√° todos los pedidos apartados y restablecer√° el stock inicial.')) {
                    localStorage.removeItem('simulatedOrders');
                    localOrders = {};
                    initializeBadges();
                    renderManualManagementPanel();
                    alert('Inventario y pedidos apartados REINICIADOS con √©xito.');
                }
            }
            
            // DIBUJAR TARJETAS DE PRODUCTO DIN√ÅMICAMENTE
            function renderProductCards() {
                let html = '';
                productData.forEach(product => {
                    html += `
                        <div class="col-lg-3 col-md-4 col-sm-6 d-flex">
                            <div class="card product-card flex-fill" data-product-id="${product.id}">
                                <span class="stock-badge" id="badge-${product.id}"></span> 
                                <img src="${product.img_main}" class="card-img-top" alt="Playera ${product.name}">
                                <div class="card-body d-flex flex-column">
                                    <h5 class="card-title">${product.name}</h5>
                                    <p class="card-text text-muted">${product.description.substring(0, 50)}...</p>
                                    <div class="mt-auto">
                                        <p class="price mb-2">$${product.price} MXN</p>
                                        <button 
                                            class="btn btn-block btn-buy w-100" 
                                            data-bs-toggle="modal" 
                                            data-bs-target="#paymentModal" 
                                            data-product-id="${product.id}"
                                            data-price="${product.price}" 
                                            data-name="${product.name}"
                                            data-description="${product.description}"
                                            data-img-front="${product.img_front}" 
                                            data-img-back="${product.img_back}">
                                            Ver Detalle y Comprar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                productListContainer.innerHTML = html;
            }

            // FUNCI√ìN: Actualiza el badge de stock en la tarjeta principal
            function updateProductBadge(productID) {
                const badg = document.getElementById(`badge-${productID}`);
                if (!badg) return;

                const availableSizes = Object.keys(productInventory[productID] || {});
                let totalAvailable = 0;
                availableSizes.forEach(size => {
                    totalAvailable += getAvailableStock(productID, size); 
                });

                badg.className = 'stock-badge';
                if (totalAvailable <= 0) {
                    badg.classList.add('agotado');
                    badg.textContent = 'AGOTADO';
                } else if (totalAvailable <= 3) { 
                    badg.classList.add('ultima');
                    badg.textContent = `¬°√öLTIMAS ${totalAvailable} PZAS!`;
                } else {
                    badg.textContent = '';
                }
                
                // Deshabilita el bot√≥n si est√° agotado
                const buyButton = document.querySelector(`.card[data-product-id="${productID}"] .btn-buy`);
                if (buyButton) {
                    buyButton.disabled = totalAvailable <= 0;
                    buyButton.textContent = totalAvailable <= 0 ? 'AGOTADO' : 'Ver Detalle y Comprar';
                }
            }

            // FUNCI√ìN: Inicializa todos los badges al cargar la p√°gina o al modificar el stock
            function initializeBadges() {
                productData.forEach(product => {
                    updateProductBadge(product.id);
                });
            }

            // Funci√≥n para crear y mostrar los botones de talla
            function createSizeButtons(productID) {
                sizeOptionsContainer.innerHTML = '';
                currentSelectedSize = null; // Reinicia la selecci√≥n
                const sizes = productInventory[productID];
                let allAgotado = true;

                for (const size in sizes) {
                    const availableStock = getAvailableStock(productID, size);
                    const disabledClass = availableStock <= 0 ? 'disabled' : '';
                    if (availableStock > 0) allAgotado = false;

                    const sizeBtn = document.createElement('span');
                    sizeBtn.className = `size-btn ${disabledClass}`;
                    sizeBtn.textContent = size;
                    sizeBtn.setAttribute('data-size', size);
                    sizeBtn.setAttribute('data-stock', availableStock);
                    
                    if (availableStock > 0) {
                        sizeBtn.addEventListener('click', function() {
                            if (sizeBtn.classList.contains('disabled')) return;
                            
                            // Limpiar la selecci√≥n previa
                            document.querySelectorAll('#size-options .size-btn').forEach(btn => {
                                btn.classList.remove('selected');
                            });
                            
                            // Seleccionar la nueva talla
                            sizeBtn.classList.add('selected');
                            currentSelectedSize = size;
                            
                            // Ajustar la cantidad al stock disponible de la talla
                            const maxStock = availableStock;
                            quantityInput.setAttribute('max', maxStock);
                            
                            // Si la cantidad actual supera el nuevo m√°ximo, ajustarla a 1
                            if (parseInt(quantityInput.value) > maxStock) {
                                quantityInput.value = 1;
                            } else if (parseInt(quantityInput.value) < 1) {
                                quantityInput.value = 1;
                            }
                            
                            sizeStatusEl.textContent = `Stock disponible: ${availableStock}`;
                            updatePriceDisplays();
                            updateModalState();
                        });
                    }
                    sizeOptionsContainer.appendChild(sizeBtn);
                }

                if (allAgotado) {
                    sizeStatusEl.textContent = 'Este producto est√° agotado en todas las tallas.';
                    mainButton.disabled = true;
                } else {
                    sizeStatusEl.textContent = 'Selecciona una talla para continuar.';
                    mainButton.disabled = true;
                }
            }
            
            // FUNCI√ìN CRUCIAL: Actualiza los precios y habilita/deshabilita el bot√≥n principal
            function updatePriceDisplays() {
                const quantity = parseInt(quantityInput.value) || 1;
                
                // 1. Validar la cantidad con el stock de la talla seleccionada
                let maxStock = 0;
                if (currentSelectedSize) {
                    maxStock = getAvailableStock(currentProductID, currentSelectedSize);
                    quantityInput.setAttribute('max', maxStock);
                    
                    if (quantity > maxStock) {
                        quantityInput.value = maxStock > 0 ? maxStock : 1; // Ajustar la cantidad
                        quantityStatusEl.textContent = maxStock > 0 ? `M√°ximo disponible: ${maxStock} piezas.` : '¬°Esta talla se acaba de agotar!';
                    } else if (quantity < 1) {
                        quantityInput.value = 1;
                        quantityStatusEl.textContent = '';
                    } else {
                        quantityStatusEl.textContent = `M√°ximo disponible: ${maxStock}`;
                    }
                } else {
                    quantityInput.setAttribute('max', 10); // Valor por defecto
                    quantityStatusEl.textContent = 'Selecciona una talla primero.';
                }
                
                // 2. Calcular los montos
                const finalQuantity = parseInt(quantityInput.value);
                currentTotalAmount = currentPrice * finalQuantity;
                currentPaymentDue = halfPaymentCheck.checked ? currentTotalAmount / 2 : currentTotalAmount;

                // 3. Actualizar el DOM
                document.getElementById('total-price').textContent = `$${currentTotalAmount.toFixed(2)} MXN`;
                document.getElementById('payment-due').textContent = `$${currentPaymentDue.toFixed(2)} MXN`;

                updateModalState();
            }

            // FUNCI√ìN CRUCIAL: Controla el estado del bot√≥n principal y la navegaci√≥n en el modal
            function updateModalState() {
                const quantity = parseInt(quantityInput.value) || 1;
                const maxStock = currentSelectedSize ? getAvailableStock(currentProductID, currentSelectedSize) : 0;
                
                const step1Valid = currentSelectedSize !== null && quantity > 0 && quantity <= maxStock;
                
                if (selectionStep.style.display !== 'none') {
                    // Estado inicial: Selecci√≥n de talla/cantidad
                    mainButton.textContent = 'Pagar Ahora';
                    mainButton.disabled = !step1Valid;
                    whatsappButton.style.display = 'none';
                    mainButton.onclick = step1Valid ? moveToPaymentStep : null;
                } else if (paymentStep.style.display !== 'none') {
                    // Estado intermedio: Ingreso de datos
                    mainButton.textContent = 'Confirmar Pedido';
                    mainButton.disabled = false; // Se validar√° al hacer clic en makeOrder
                    whatsappButton.style.display = 'none';
                    mainButton.onclick = makeOrder;
                } else if (transferInfo.style.display !== 'none') {
                    // Estado final: Informaci√≥n de transferencia
                    mainButton.style.display = 'none';
                    whatsappButton.style.display = 'inline-block';
                    document.getElementById('modal-close-button').textContent = 'Cerrar';
                }
            }

            // Funci√≥n para pasar del paso 1 al paso 2
            function moveToPaymentStep() {
                selectionStep.style.display = 'none';
                paymentStep.style.display = 'block';
                
                // Actualizar los datos de resumen en el paso 2
                document.getElementById('final-quantity-display').textContent = quantityInput.value;
                document.getElementById('final-size-display').textContent = currentSelectedSize;
                document.getElementById('final-price-display').textContent = `$${currentPaymentDue.toFixed(2)} MXN`;

                updateModalState();
            }

            // Funci√≥n para finalizar el pedido
            function makeOrder() {
                const clientName = clientNameInput.value.trim();
                const clientPhone = clientPhoneInput.value.trim();
                const clientAddress = clientAddressInput.value.trim();

                if (!clientName || !clientPhone || !clientAddress) {
                    paymentError.style.display = 'block';
                    return;
                }
                paymentError.style.display = 'none';
                
                // 1. Guardar pedido y reservar stock
                const orderKey = `${currentProductID}-${currentSelectedSize}`;
                const quantity = parseInt(quantityInput.value);
                
                // CORRECCI√ìN: Si ya hay un pedido para esta talla, sumar la cantidad
                if (localOrders[orderKey]) {
                    localOrders[orderKey].quantity += quantity;
                } else {
                    localOrders[orderKey] = {
                        productID: currentProductID,
                        productName: currentProductName,
                        size: currentSelectedSize,
                        quantity: quantity,
                        clientName: clientName,
                        clientPhone: clientPhone,
                        clientAddress: clientAddress,
                        paymentDue: currentPaymentDue,
                        totalAmount: currentTotalAmount,
                        isHalfPayment: halfPaymentCheck.checked,
                        status: 'pending'
                    };
                }
                saveLocalOrders();
                initializeBadges(); // Actualiza los badges de la p√°gina principal
                
                // 2. Mostrar informaci√≥n de transferencia
                paymentStep.style.display = 'none';
                transferInfo.style.display = 'block';
                mainButton.style.display = 'none';
                
                // 3. Rellenar los datos de confirmaci√≥n
                document.getElementById('client-name-display').textContent = clientName;
                document.getElementById('final-qty-conf').textContent = quantity;
                document.getElementById('final-item-display').textContent = currentProductName;
                document.getElementById('final-size-conf').textContent = currentSelectedSize;
                document.getElementById('final-amount-conf').textContent = `$${currentPaymentDue.toFixed(2)} MXN`;

                // 4. Generar enlace de WhatsApp
                const whatsappMessage = encodeURIComponent(
                    `¬°Hola! Acabo de hacer un pedido en RPLAY.\n\n` +
                    `*Mi Nombre:* ${clientName}\n` +
                    `*Tel√©fono:* ${clientPhone}\n` +
                    `*Direcci√≥n:* ${clientAddress}\n\n` +
                    `*Detalle del Pedido:*\n` +
                    `Producto: ${currentProductName}\n` +
                    `Talla: ${currentSelectedSize}\n` +
                    `Cantidad: ${quantity} pieza(s)\n` +
                    `Monto a pagar ahora: $${currentPaymentDue.toFixed(2)} MXN\n\n` +
                    `Adjunto mi comprobante de pago por ${halfPaymentCheck.checked ? 'apartado' : 'total'}.`
                );
                whatsappButton.href = `https://wa.me/${WHATSAPP_PHONE}?text=${whatsappMessage}`;
                
                updateModalState();
            }

            // Funci√≥n para restablecer el modal al cerrarse
            function resetModalView() {
                // Paso 1
                selectionStep.style.display = 'block';
                paymentStep.style.display = 'none';
                transferInfo.style.display = 'none';

                // Botones
                mainButton.style.display = 'inline-block';
                mainButton.textContent = 'Pagar Ahora';
                mainButton.disabled = true;
                whatsappButton.style.display = 'none';
                document.getElementById('modal-close-button').textContent = 'Cerrar';
                
                // Variables de estado
                currentSelectedSize = null;
                quantityInput.value = 1;
                quantityStatusEl.textContent = '';
                sizeStatusEl.textContent = 'Selecciona una talla para continuar.';
                paymentError.style.display = 'none';
                
                // Inputs de usuario
                clientNameInput.value = '';
                clientPhoneInput.value = '';
                clientAddressInput.value = '';
            }
            
            // --- Event Listeners del Modal ---
            
            // Cuando se abre el modal
            paymentModal.addEventListener('show.bs.modal', function (event) {
                const button = event.relatedTarget;
                
                // 1. Cargar datos del producto
                currentProductID = button.getAttribute('data-product-id');
                currentProductName = button.getAttribute('data-name');
                // CORRECCI√ìN: Cargar el precio del producto
                currentPrice = parseFloat(button.getAttribute('data-price')); 
                
                document.getElementById('product-name').textContent = currentProductName;
                document.getElementById('product-description').textContent = button.getAttribute('data-description');
                document.getElementById('modal-img-front').src = button.getAttribute('data-img-front');
                document.getElementById('modal-img-back').src = button.getAttribute('data-img-back');

                // 2. Resetear la vista y generar botones
                resetModalView();
                createSizeButtons(currentProductID);
                updatePriceDisplays(); // Inicializa los precios
            });
            
            // Cuando se cambia la cantidad o el estado de pago
            quantityInput.addEventListener('input', updatePriceDisplays);
            halfPaymentCheck.addEventListener('change', updatePriceDisplays);

            // Llamada inicial para renderizar y actualizar el estado
            renderProductCards();
            initializeBadges();
            renderManualManagementPanel(); // Inicializa el panel de administraci√≥n
        });
    </script>
</body>
</html>



