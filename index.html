<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPLAY</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.bundle.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* --- Estilos Generales --- */
        body {
            background-color: #f8f9fa;
        }
        .container {
            margin-top: 20px;
        }
        .product-card {
            border: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            position: relative;
            margin-bottom: 20px;
            overflow: hidden;
        }
        .product-card:hover {
            transform: translateY(-5px);
        }
        .product-card img {
            height: 250px;
            object-fit: cover;
        }
        .price {
            font-size: 1.25rem;
            font-weight: bold;
            color: #d63384; /* Color de acento */
        }
        .btn-buy {
            background-color: #d63384;
            color: white;
            border: none;
        }
        .btn-buy:hover {
            background-color: #b82b71;
            color: white;
        }

        /* --- Estilos de Stock (Badges) --- */
        .stock-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            font-weight: bold;
            z-index: 10;
            color: white;
            background-color: rgba(0, 0, 0, 0.5); /* Por defecto, casi invisible si hay mucho stock */
        }
        .stock-badge.agotado {
            background-color: #dc3545; /* Rojo */
            color: white;
        }
        .stock-badge.ultima {
            background-color: #ffc107; /* Amarillo */
            color: #343a40;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* --- Estilos del Modal --- */
        .modal-header {
            border-bottom: none;
        }
        .size-options .size-btn {
            display: inline-block;
            padding: 8px 15px;
            margin: 5px;
            border: 2px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
        }
        .size-options .size-btn:hover {
            background-color: #eee;
        }
        .size-options .size-btn.selected {
            background-color: #d63384;
            color: white;
            border-color: #d63384;
        }
        .size-options .size-btn.disabled {
            background-color: #f1f1f1;
            color: #999;
            border-color: #eee;
            cursor: not-allowed;
            text-decoration: line-through;
        }

        /* --- Estilos de la Galer√≠a de Im√°genes --- */
        #product-image-preview {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
        }
        .thumbnail-img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 5px;
            cursor: pointer;
            border: 2px solid transparent;
            margin-right: 5px;
        }
        .thumbnail-img.active {
            border-color: #d63384;
        }

        /* --- Estilos de la Administraci√≥n --- */
        #manualManagementPanel {
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1 class="text-center my-4">üõçÔ∏è Playeras Exclusivas</h1>
        
        <div class="text-end mb-3" style="display: none;">
            <button id="admin-login-btn" class="btn btn-sm btn-outline-secondary">
                <i class="fas fa-tools"></i> Admin
            </button>
        </div>

        <div id="manualManagementPanel" class="p-3 mb-4 rounded" style="display: none;">
            <h4 class="text-warning"><i class="fas fa-exclamation-triangle"></i> Panel de Administraci√≥n - INVENTARIO</h4>
            <div id="ordersList" class="my-3">
                </div>
            <button class="btn btn-sm btn-danger w-100 mt-2" onclick="resetAllStock()">
                <i class="fas fa-trash-restore-alt"></i> Borrar TODAS las Reservas y Restaurar Inventario
            </button>
        </div>
        
        <div id="product-list" class="row">
            </div>
    </div>

    <div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="paymentModalLabel">Comprar: <span id="modal-product-name" class="text-primary"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    
                    <div id="selection-step">
                        <div class="row">
                            <div class="col-md-6 text-center">
                                <img id="product-image-preview" src="" alt="Playera" class="img-fluid">
                                <div id="thumbnail-gallery" class="d-flex justify-content-center mb-3">
                                    </div>
                                <p class="text-muted" id="modal-product-description"></p>
                            </div>
                            <div class="col-md-6">
                                <h4 class="mb-3">Selecciona tu talla y cantidad:</h4>
                                
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Talla:</label>
                                    <div id="size-options" class="size-options">
                                        </div>
                                    <small class="text-success" id="size-status">Selecciona una talla para ver el stock.</small>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="quantityInput" class="form-label fw-bold">Cantidad:</label>
                                    <input type="number" id="quantityInput" class="form-control" value="1" min="1" max="1" disabled>
                                    <small class="text-muted" id="quantity-status">M√°ximo 1 unidad por pedido.</small>
                                </div>
                                
                                <div class="alert alert-info mt-3">
                                    <h5 class="mb-0">Precio Unitario: <span id="modal-unit-price" class="fw-bold">$0.00 MXN</span></h5>
                                </div>
                                
                                <p class="text-danger mt-3" style="display:none;" id="selection-error">
                                    <i class="fas fa-exclamation-circle"></i> Por favor, selecciona una talla antes de continuar.
                                </p>
                            </div>
                        </div>
                    </div>

                    <div id="payment-step" style="display:none;">
                        <h4>2. Completa tus datos de env√≠o:</h4>
                        <p class="text-muted">Necesitamos estos datos para generar tu pedido y apartar tu playera.</p>
                        
                        <div id="payment-step-info-box" class="alert alert-info">
                            Est√°s comprando <span id="payment-step-quantity">1</span> pieza(s) talla <span id="payment-step-size">L</span> por <span id="payment-step-price">$250.00 MXN</span>. Llena tus datos para guardar el pedido y ver las instrucciones de pago por transferencia.
                        </div>
                        
                        <form id="client-data-form">
                            <div class="mb-3">
                                <label for="clientName" class="form-label">Nombre Completo:</label>
                                <input type="text" class="form-control" id="clientName" required>
                            </div>
                            <div class="mb-3">
                                <label for="clientPhone" class="form-label">Tel√©fono (WhatsApp):</label>
                                <input type="tel" class="form-control" id="clientPhone" required>
                            </div>
                            <div class="mb-3">
                                <label for="clientAddress" class="form-label">Direcci√≥n Completa de Env√≠o:</label>
                                <textarea class="form-control" id="clientAddress" rows="3" required></textarea>
                            </div>
                            
                            <p class="text-danger mt-3" style="display:none;" id="payment-error">
                                <i class="fas fa-exclamation-circle"></i> Por favor, completa todos los campos para continuar.
                            </p>
                        </form>
                    </div>

                    <div id="transfer-info" style="display:none;">
                        <h4>3. Realiza tu pago o dep√≥sito:</h4>
                        <div class="alert alert-success">
                            <p class="mb-1"><strong>¬°Pedido Pre-Aprobado!</strong> Tienes **24 horas** para realizar tu dep√≥sito y enviar tu comprobante. **Tu playera queda apartada al enviar el comprobante por WhatsApp.**</p>
                        </div>
                        
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" value="" id="halfPaymentCheck" checked>
                            <label class="form-check-label fw-bold" for="halfPaymentCheck">
                                Pago Parcial (Apartado): <span class="text-muted small">(Paga la mitad ahora, el resto a la entrega)</span>
                            </label>
                        </div>
                        
                        <div class="card bg-light p-3 mb-3">
                            <h5>Detalle del Pago</h5>
                            <p class="mb-1">Total de la Compra: <span class="float-end fw-bold" id="total-price">$0.00 MXN</span></p>
                            <hr class="my-2">
                            <p class="mb-0 text-success">Monto a Pagar Ahora: <span class="float-end fw-bold fs-5" id="payment-due">$0.00 MXN</span></p>
                        </div>
                        
                        <div class="card border-primary p-3">
                            <h5 class="text-primary"><i class="fas fa-university"></i> Datos de Dep√≥sito/Transferencia</h5>
                            <p class="mb-1">Banco: **BBVA**</p>
                            <p class="mb-1">Cuenta: **0123 4567 89**</p>
                            <p class="mb-0">CLABE: **0123 4567 8901 2345 67**</p>
                        </div>
                    </div>
                </div>
                
                <div class="modal-footer d-flex justify-content-between">
                    <button type="button" class="btn btn-secondary" id="modal-close-button" data-bs-dismiss="modal">Cerrar</button>
                    
                    <button type="button" class="btn btn-primary" id="modal-main-button" disabled>
                        Apartar y Ver Datos de Pago
                    </button>

                    <a id="whatsapp-confirm-button" class="btn btn-success" target="_blank" style="display:none;">
                        <i class="fab fa-whatsapp"></i> Enviar Comprobante por WhatsApp
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        
        // --- 1. GENERACI√ìN DIN√ÅMICA DE INVENTARIO INICIAL (70 Productos) ---
        const productInventory = {};
        const productData = [];
        const DEFAULT_GLOBAL_SIZES = ["M", "L", "XL"];
        const FIXED_PRICE = 250.00; 
        const DEFAULT_STOCK_PER_SIZE = 1;
        const WHATSAPP_PHONE = "529991480151"; // N√∫mero de WhatsApp del vendedor
        const ADMIN_HASH = "819c99d25145b5c9b740751939331908"; // Hash para 'admin123'
        
        for (let i = 1; i <= 70; i++) {
            const id = `PROD_${String(i).padStart(3, '0')}`;
            let mainImg, frontImg, backImg;
            let modelSizes = [...DEFAULT_GLOBAL_SIZES]; 
            let initialStockOverrides = {};
            
            // Im√°genes de placeholder para los modelos sin imagen expl√≠cita
            mainImg = 'https://via.placeholder.com/250x250/F4E3F5?text=Modelo+' + i;
            frontImg = 'https://via.placeholder.com/500x500/F4E3F5?text=Frente+' + i;
            backImg = 'https://via.placeholder.com/500x500/F4E3F5?text=Espalda+' + i;

            // --- L√≥gica para configurar tallas y stock por modelo (Personaliza aqu√≠) ---
            if (i === 1) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Xime1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Xime1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Xime2.png';
                modelSizes = ['S', 'M', 'L']; 
                initialStockOverrides.S = 2; 
                initialStockOverrides.M = 1; 
                initialStockOverrides.L = 1; 
            } 
            else if (i === 2 ) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Xime3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Xime3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Xime4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 3 ) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Lucy1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Lucy1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Lucy2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 4 ) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Lucy3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Lucy3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Lucy4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 5 ) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Raul1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Raul1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Raul2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 6 ) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Raul3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Raul3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Raul4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 7 ) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Abi1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Abi1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Abi2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 8 ) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Abi3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Abi3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Abi4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 9 ) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Dani1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Dani1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Dani2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 10 ) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Dani3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Dani3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Dani4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 11 ) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Dali1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Dali1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Dali2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 12 ) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Dali3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Dali3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Dali4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 13 ) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Yose1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Yose1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Yose2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 14 ) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Yose3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Yose3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Yose4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 15 ) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Keila1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Keila1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Keila2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 16 ) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Keila3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Keila3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Keila4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 17 ) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Kenji1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Kenji1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Kenji2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 18 ) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Kenji3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Kenji3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Kenji4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 19 ) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Alli1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Alli1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Alli2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 20 ) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Alli3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Alli3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Alli4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            } else if (i === 21 ) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Ale1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Ale1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Ale2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            }else if (i === 22 ) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Ale3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Ale3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Ale4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            }else if (i === 23 ) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Miri1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Miri1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Miri2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            }else if (i === 24 ) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Miri3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Miri3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Miri4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            }else if (i === 25 ) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Didi1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Didi1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Didi2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            }else if (i === 26 ) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Didi3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Didi3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Didi4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            }else if (i === 27 ) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Caro1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Caro1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Caro2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            }else if (i === 28 ) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Caro3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Caro3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Caro4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            }else if (i === 29 ) { 
                mainImg = 'https://ventaplayera.github.io/RPLAY/Vale1.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Vale1.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Vale2.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            }else if (i === 30 ) { 
                // Corregido un typo en la URL de mainImg de Valei3 a Vale3 para mantener consistencia si es error de URL
                mainImg = 'https://ventaplayera.github.io/RPLAY/Vale3.png'; 
                frontImg = 'https://ventaplayera.github.io/RPLAY/Vale3.png';
                backImg = 'https://ventaplayera.github.io/RPLAY/Vale4.png';
                modelSizes = ['M', 'L', 'XL'];
                initialStockOverrides.M = 1; 
                initialStockOverrides.L=1;
                initialStockOverrides.XL=1;
            }
            // --- FIN DE NUEVAS IM√ÅGENES Y CORRECCIONES ---


            // L√≥gica para asignar stock inicial (combina overrides y defecto)
            const stock = {};
            modelSizes.forEach(size => {
                stock[size] = initialStockOverrides[size] !== undefined ? initialStockOverrides[size] : DEFAULT_STOCK_PER_SIZE;
            });
            productInventory[id] = stock;
            productData.push({
                id: id,
                name: `Playera Modelo No. ${i}`,
                price: FIXED_PRICE.toFixed(2), 
                description: `Dise√±o exclusivo #${i} con estampado digital de alta calidad. Tela de algod√≥n 100% de la mejor calidad.`,
                img_main: mainImg,
                img_front: frontImg,
                img_back: backImg
            });
        }
        
        // --- 2. INVENTARIO PERSISTENTE (Pedidos Apartados) ---
        let localOrders = JSON.parse(localStorage.getItem('simulatedOrders')) || {};
        
        // --- 3. L√≥gica del Sistema ---

        document.addEventListener('DOMContentLoaded', function () {
            
            // --- REFERENCIAS A ELEMENTOS HTML ---
            const productListContainer = document.getElementById('product-list');
            const paymentModalElement = document.getElementById('paymentModal');
            const paymentModal = new bootstrap.Modal(paymentModalElement);
            const selectionStep = document.getElementById('selection-step');
            const paymentStep = document.getElementById('payment-step');
            const transferInfo = document.getElementById('transfer-info');
            const sizeOptionsContainer = document.getElementById('size-options');
            const halfPaymentCheck = document.getElementById('halfPaymentCheck');
            const clientNameInput = document.getElementById('clientName');
            const clientPhoneInput = document.getElementById('clientPhone');
            const clientAddressInput = document.getElementById('clientAddress');
            const mainButton = document.getElementById('modal-main-button');
            const whatsappButton = document.getElementById('whatsapp-confirm-button'); 
            const ordersList = document.getElementById('ordersList'); 
            const sizeStatusEl = document.getElementById('size-status'); 
            const quantityInput = document.getElementById('quantityInput');
            const quantityStatusEl = document.getElementById('quantity-status');
            const adminLoginBtn = document.getElementById('admin-login-btn');
            const managementPanel = document.getElementById('manualManagementPanel');
            const productImagePreview = document.getElementById('product-image-preview');
            const thumbnailGallery = document.getElementById('thumbnail-gallery');

            // Variables de estado
            let currentPrice = FIXED_PRICE;
            let currentSelectedSize = null;
            let currentSelectedQuantity = 1;
            let currentProductName = '';
            let currentProductID = ''; 
            let modalStep = 1; // 1: Selecci√≥n, 2: Datos, 3: Confirmaci√≥n
            
            // --- Funciones de L√≥gica de Inventario y Pedidos ---
            
            function saveLocalOrders() {
                localStorage.setItem('simulatedOrders', JSON.stringify(localOrders));
                if (managementPanel.style.display === 'block') {
                    renderManualManagementPanel(); 
                }
            }
            
            // Funci√≥n CLAVE: Aparta el stock en localOrders (SE LLAMA SOLO AL ENVIAR EL COMPROBANTE)
            function reserveStock() {
                const orderKey = `${currentProductID}-${currentSelectedSize}`;
                localOrders[orderKey] = (localOrders[orderKey] || 0) + currentSelectedQuantity;
                saveLocalOrders();
                initializeBadges();
            }

            function getAvailableStock(productID, size) {
                const stock = productInventory[productID] && productInventory[productID][size] !== undefined ? productInventory[productID][size] : 0;
                // La cantidad de unidades que est√°n apartadas y NO disponibles
                const pendingOrders = localOrders[`${productID}-${size}`] || 0; 
                return stock - pendingOrders;
            }
            
            // Funciones de Administraci√≥n (Accedidas globalmente)
            window.setStock = function(productID, size, newStock) {
                if (productInventory[productID] && productInventory[productID][size] !== undefined) {
                    newStock = parseInt(newStock);
                    if (isNaN(newStock) || newStock < 0) {
                        alert("Error: El stock debe ser un n√∫mero positivo.");
                        return;
                    }
                    productInventory[productID][size] = newStock;
                    saveLocalOrders(); 
                    initializeBadges();
                    alert(`‚úÖ Stock inicial de ${productID} - Talla ${size} modificado a ${newStock}.`);
                } else {
                    alert("Error: Producto o talla no encontrados.");
                }
            };

            window.releaseOrder = function(orderKey) {
                if (localOrders[orderKey]) {
                    const quantityToRelease = localOrders[orderKey];
                    delete localOrders[orderKey];
                    saveLocalOrders();
                    initializeBadges();
                    alert(`‚úÖ Pedido ${orderKey} liberado. ${quantityToRelease} unidad(es) devueltas al stock.`);
                } else {
                    alert("Error: Pedido no encontrado.");
                }
            };
            
            window.resetAllStock = function() {
                if (confirm("¬°ADVERTENCIA! ¬øEst√°s seguro de querer borrar TODOS los pedidos apartados (reservas) y restaurar el stock a su estado inicial? Esta acci√≥n no se puede deshacer.")) {
                    localOrders = {};
                    saveLocalOrders();
                    initializeBadges();
                    alert("‚úÖ Inventario restaurado. Todos los pedidos apartados han sido borrados.");
                }
            };
            
            function simpleHash(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash |= 0; 
                }
                return hash.toString(16).replace('-', 'f');
            }


            // --- Funciones de Renderizado y UI ---

            function updateProductBadge(productID) {
                const badgeElement = document.getElementById(`badge-${productID}`);
                if (!badgeElement) return;

                let totalAvailable = 0;
                const productSizes = productInventory[productID] ? Object.keys(productInventory[productID]) : [];
                
                productSizes.forEach(size => {
                    totalAvailable += getAvailableStock(productID, size);
                });

                badgeElement.className = 'stock-badge';
                if (totalAvailable <= 0) {
                    badgeElement.classList.add('agotado');
                    badgeElement.textContent = 'AGOTADO';
                } else if (totalAvailable <= 3 && totalAvailable > 0) {
                    badgeElement.classList.add('ultima');
                    badgeElement.textContent = '¬°POCAS UNIDADES!';
                } else {
                    badgeElement.textContent = ''; // Limpiar si hay suficiente stock
                }
            }

            function initializeBadges() {
                productData.forEach(p => updateProductBadge(p.id));
            }
            
            function renderProductCards() {
                productListContainer.innerHTML = ''; 
                productData.forEach(product => {
                    const col = document.createElement('div');
                    col.className = 'col-6 col-md-4 col-lg-3'; 
                    col.innerHTML = `
                        <div class="card product-card" data-product-id="${product.id}">
                            <span class="stock-badge" id="badge-${product.id}"></span>
                            <img src="${product.img_main}" class="card-img-top" alt="${product.name}">
                            <div class="card-body text-center">
                                <h5 class="card-title mb-1">${product.name}</h5>
                                <p class="price mb-2">$${product.price} MXN</p>
                                <button type="button" class="btn btn-buy" data-bs-toggle="modal" data-bs-target="#paymentModal" data-product-id="${product.id}">
                                    Ver Detalle y Comprar
                                </button>
                            </div>
                        </div>
                    `;
                    productListContainer.appendChild(col);
                });
                initializeBadges();
            }
            
            function updateGallery(product) {
                const images = [
                    { src: product.img_front, alt: 'Frente' },
                    { src: product.img_back, alt: 'Espalda' }
                ];

                // Si la imagen principal es diferente a frente, la incluimos
                if (product.img_main !== product.img_front && product.img_main !== product.img_back) {
                     images.unshift({ src: product.img_main, alt: 'Principal' });
                }

                thumbnailGallery.innerHTML = '';
                productImagePreview.src = product.img_front; // Establecer la vista principal por defecto
                
                images.forEach((img, index) => {
                    const thumbnail = document.createElement('img');
                    thumbnail.src = img.src;
                    thumbnail.alt = img.alt;
                    thumbnail.className = 'thumbnail-img';
                    if (index === 0 || img.src === product.img_front) {
                        thumbnail.classList.add('active');
                    }
                    thumbnail.addEventListener('click', () => {
                        productImagePreview.src = img.src;
                        document.querySelectorAll('.thumbnail-img').forEach(t => t.classList.remove('active'));
                        thumbnail.classList.add('active');
                    });
                    thumbnailGallery.appendChild(thumbnail);
                });
            }


            function createSizeButtons(productID) {
                sizeOptionsContainer.innerHTML = '';
                currentSelectedSize = null;
                mainButton.disabled = true;

                const sizes = productInventory[productID] ? Object.keys(productInventory[productID]).sort() : []; // Ordenar tallas
                const sizeErrorEl = document.getElementById('selection-error');
                sizeErrorEl.style.display = 'none';

                if (sizes.length === 0) {
                    sizeOptionsContainer.innerHTML = '<p class="text-danger">Producto no disponible.</p>';
                    return;
                }
                
                sizes.forEach(size => {
                    const stock = getAvailableStock(productID, size);
                    const button = document.createElement('span');
                    button.className = 'size-btn';
                    button.textContent = size;
                    button.setAttribute('data-size', size);

                    if (stock <= 0) {
                        button.classList.add('disabled');
                        button.title = 'Agotado';
                    } else {
                        button.addEventListener('click', () => handleSizeSelection(size, productID));
                    }
                    sizeOptionsContainer.appendChild(button);
                });
                
                // Seleccionar la primera talla disponible autom√°ticamente si solo hay una
                const availableSizes = sizes.filter(size => getAvailableStock(productID, size) > 0);
                if (availableSizes.length === 1) {
                    handleSizeSelection(availableSizes[0], productID);
                }
            }
            
            function handleSizeSelection(size, productID) {
                const stock = getAvailableStock(productID, size);
                
                if (stock <= 0) return;

                document.querySelectorAll('.size-btn').forEach(btn => btn.classList.remove('selected'));
                
                const selectedButton = document.querySelector(`.size-btn[data-size="${size}"]`);
                if (selectedButton) {
                    selectedButton.classList.add('selected');
                }

                currentSelectedSize = size;
                
                sizeStatusEl.textContent = stock > 5 ? `¬°${stock} unidades disponibles!` : `¬°Quedan s√≥lo ${stock} unidades! ¬°Aparta la tuya!`;
                
                // Actualizar la cantidad m√°xima y el valor
                quantityInput.max = stock;
                currentSelectedQuantity = Math.min(parseInt(quantityInput.value) || 1, stock);
                quantityInput.value = currentSelectedQuantity;
                
                // Habilitar/deshabilitar el input de cantidad
                quantityInput.disabled = (stock <= 1);
                quantityStatusEl.textContent = stock <= 1 ? "M√°ximo 1 unidad por pedido." : `Puedes pedir hasta ${stock} unidades.`;

                updatePaymentAmounts();
                mainButton.disabled = false;
            }

            function updatePaymentAmounts() {
                if (!currentSelectedSize || currentSelectedQuantity <= 0) return;
                
                const total = currentPrice * currentSelectedQuantity;
                
                // El monto a pagar depende del checkbox
                const paymentFactor = halfPaymentCheck.checked ? 0.5 : 1.0;
                const paymentDue = total * paymentFactor;
                
                document.getElementById('total-price').textContent = `$${total.toFixed(2)} MXN`;
                document.getElementById('payment-due').textContent = `$${paymentDue.toFixed(2)} MXN`;
                
                // Si estamos en el paso 2 o 3, actualiza tambi√©n el mensaje din√°mico
                if (modalStep >= 2) { 
                    updatePaymentStepInfo(); 
                }
            }
            
            // --- FUNCI√ìN PARA ACTUALIZAR INFO DEL PASO 2 (Datos Comprador) ---
            function updatePaymentStepInfo() {
                const total = currentPrice * currentSelectedQuantity;
                const paymentFactor = halfPaymentCheck.checked ? 0.5 : 1.0;
                const paymentDue = total * paymentFactor;
                
                // Referencias a los SPAN dentro del alert-info del Paso 2 (Datos Comprador)
                const quantityElement = document.getElementById('payment-step-quantity');
                const sizeElement = document.getElementById('payment-step-size');
                const priceElement = document.getElementById('payment-step-price');
                
                if (quantityElement) quantityElement.textContent = currentSelectedQuantity;
                if (sizeElement) sizeElement.textContent = currentSelectedSize;
                
                // Actualizar el texto del alert
                const infoBox = document.getElementById('payment-step-info-box');
                if (infoBox) {
                     let paymentType = '';
                     if (paymentFactor === 0.5) {
                         paymentType = ' (Monto de Apartado)';
                     }
                    
                     infoBox.innerHTML = `Est√°s comprando **${currentSelectedQuantity}** pieza(s) talla **${currentSelectedSize}** por **$${paymentDue.toFixed(2)} MXN**${paymentType}. Llena tus datos para guardar el pedido y ver las instrucciones de pago por transferencia.`;
                }
            }
            // --- FIN FUNCI√ìN PARA ACTUALIZAR INFO DEL PASO 2 ---
            
            function resetModalView() {
                modalStep = 1;
                selectionStep.style.display = 'block';
                paymentStep.style.display = 'none';
                transferInfo.style.display = 'none';
                
                mainButton.style.display = 'inline-block';
                whatsappButton.style.display = 'none';
                document.getElementById('modal-close-button').style.display = 'inline-block';
                
                mainButton.textContent = 'Apartar y Ver Datos de Pago'; 
                mainButton.disabled = currentSelectedSize === null;
                
                clientNameInput.value = '';
                clientPhoneInput.value = '';
                clientAddressInput.value = '';
                document.getElementById('payment-error').style.display = 'none';
                document.getElementById('selection-error').style.display = 'none';

                quantityInput.value = 1; // Resetear cantidad
                currentSelectedQuantity = 1;
                halfPaymentCheck.checked = true; // Por defecto, iniciar en modo apartado
            }
            
            function renderManualManagementPanel() {
                ordersList.innerHTML = '';
                let hasOrders = false;
                
                const sortedKeys = Object.keys(localOrders).sort();

                if (sortedKeys.length === 0) {
                    ordersList.innerHTML = '<p class="text-info">No hay pedidos apartados pendientes de confirmar.</p>';
                    return;
                }

                sortedKeys.forEach(key => {
                    const quantity = localOrders[key];
                    if (quantity > 0) {
                        hasOrders = true;
                        const [productID, size] = key.split('-');
                        const product = productData.find(p => p.id === productID);
                        const productName = product ? product.name : productID;

                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'd-flex justify-content-between align-items-center border-bottom py-2';
                        itemDiv.innerHTML = `
                            <span>**${productName}** (Talla: ${size}, Cant: ${quantity})</span>
                            <button class="btn btn-sm btn-danger" onclick="releaseOrder('${key}')">Liberar</button>
                        `;
                        ordersList.appendChild(itemDiv);
                    }
                });
                
                if (!hasOrders) {
                    ordersList.innerHTML = '<p class="text-info">No hay pedidos apartados pendientes de confirmar.</p>';
                }
            }


            // --- Event Listeners ---

            // Cuando el modal se abre
            paymentModalElement.addEventListener('show.bs.modal', function (event) {
                resetModalView();
                const button = event.relatedTarget;
                currentProductID = button.getAttribute('data-product-id');
                const product = productData.find(p => p.id === currentProductID);
                
                if (product) {
                    currentProductName = product.name;
                    currentPrice = parseFloat(product.price);
                    
                    document.getElementById('modal-product-name').textContent = product.name;
                    document.getElementById('modal-unit-price').textContent = `$${product.price} MXN`;
                    document.getElementById('modal-product-description').textContent = product.description;
                    
                    updateGallery(product);
                    createSizeButtons(currentProductID);
                }
            });

            // Cuando el modal se cierra, asegurar que el stock se muestre actualizado
            paymentModalElement.addEventListener('hide.bs.modal', function () {
                initializeBadges();
            });
            
            // L√≥gica para avanzar entre pasos del modal
            mainButton.addEventListener('click', function () {
                document.getElementById('payment-error').style.display = 'none';
                document.getElementById('selection-error').style.display = 'none';

                if (modalStep === 1) {
                    // --- PASO 1 a PASO 2: Selecci√≥n a Datos de Cliente ---
                    if (!currentSelectedSize) {
                        document.getElementById('selection-error').style.display = 'block';
                        return;
                    }

                    // Se verifica el stock final en caso de que alguien m√°s haya comprado en ese momento
                    if (getAvailableStock(currentProductID, currentSelectedSize) < currentSelectedQuantity) {
                        alert("¬°Lo sentimos! El stock disponible de la talla seleccionada ha cambiado. Por favor, revisa el stock actual y ajusta tu pedido.");
                        createSizeButtons(currentProductID); // Recarga para mostrar stock real
                        return;
                    }

                    modalStep = 2;
                    selectionStep.style.display = 'none';
                    paymentStep.style.display = 'block';
                    mainButton.textContent = 'Ver Datos de Pago y Confirmar Apartado';
                    mainButton.disabled = false;
                    
                    // ¬°LLAMADA CLAVE! Actualiza el precio en el texto del Paso 2
                    updatePaymentStepInfo();
                
                } else if (modalStep === 2) {
                    // --- PASO 2 a PASO 3: Datos de Cliente a Confirmaci√≥n/Pago ---
                    const name = clientNameInput.value.trim();
                    const phone = clientPhoneInput.value.trim();
                    const address = clientAddressInput.value.trim();

                    if (!name || !phone || !address) {
                        document.getElementById('payment-error').style.display = 'block';
                        return;
                    }
                    
                    modalStep = 3;
                    paymentStep.style.display = 'none';
                    transferInfo.style.display = 'block';
                    
                    // Ocultar bot√≥n principal y mostrar bot√≥n de WhatsApp
                    mainButton.style.display = 'none';
                    whatsappButton.style.display = 'inline-block';
                    
                    updatePaymentAmounts(); // Recalcular por si cambi√≥ el checkbox

                    // Se agrega el listener del bot√≥n de WhatsApp en la funci√≥n init (m√°s abajo)
                }
            });
            
            // Listener para el cambio de cantidad
            quantityInput.addEventListener('input', function() {
                const stock = getAvailableStock(currentProductID, currentSelectedSize);
                let value = parseInt(this.value);
                
                if (isNaN(value) || value < 1) {
                    value = 1;
                }
                if (value > stock) {
                    value = stock;
                }
                this.value = value;
                currentSelectedQuantity = value;
                updatePaymentAmounts();
            });

            // Listener para el cambio en el tipo de pago (Total/Mitad)
            halfPaymentCheck.addEventListener('change', updatePaymentAmounts);
            
            
            // --- L√ìGICA CLAVE: Apartar al enviar comprobante (Paso 3) ---
            whatsappButton.addEventListener('click', function (event) {
                // 1. APARTAR EL STOCK
                reserveStock(); 
                
                // 2. GENERAR EL MENSAJE DE WHATSAPP
                const total = currentPrice * currentSelectedQuantity;
                const paymentFactor = halfPaymentCheck.checked ? 0.5 : 1.0;
                const paymentDue = total * paymentFactor;
                const paymentType = halfPaymentCheck.checked ? 'Apartado (50%)' : 'Pago Total (100%)';

                const orderDetails = `*Playera:* ${currentProductName}\n*Talla:* ${currentSelectedSize}\n*Cantidad:* ${currentSelectedQuantity}\n*Total:* $${total.toFixed(2)} MXN\n*Monto a Pagar:* $${paymentDue.toFixed(2)} MXN (${paymentType})\n\n*Datos del Cliente:*\n*Nombre:* ${clientNameInput.value.trim()}\n*Tel√©fono:* ${clientPhoneInput.value.trim()}\n*Direcci√≥n:* ${clientAddressInput.value.trim()}\n\n¬°Adjunto mi comprobante de pago!\nGracias.`;

                const whatsappLink = `https://wa.me/${WHATSAPP_PHONE}?text=${encodeURIComponent('¬°Hola! Quiero confirmar mi pedido:\n\n' + orderDetails)}`;
                
                // 3. Redirigir (El target="_blank" asegura que el modal se mantenga)
                this.href = whatsappLink;

                // Opcional: Cerrar el modal despu√©s de un peque√±o delay para que la reserva sea visible
                setTimeout(() => {
                    paymentModal.hide();
                }, 500); 
            });


            // --- L√≥gica de Administraci√≥n Oculta (Puerta Trasera) ---
            
            function showAdminPanel(password) {
                const managementPanel = document.getElementById('manualManagementPanel');
                const adminLoginBtn = document.getElementById('admin-login-btn'); 
                
                if (password && simpleHash(password) === ADMIN_HASH) {
                    managementPanel.style.display = 'block';
                    adminLoginBtn.style.display = 'none'; 
                    renderManualManagementPanel();
                    console.log("‚úÖ Acceso de Administrador concedido. Panel visible.");
                } else {
                    console.error("‚ùå Acceso denegado. Contrase√±a incorrecta o ausente.");
                }
            }

            // EXPOSICI√ìN GLOBAL PARA ACCESO POR CONSOLA
            // Puedes acceder escribiendo en la consola: admin('tu_contrase√±a_aqui')
            window.admin = function(password) {
                showAdminPanel(password);
            };
            
            // Opcional: Atajo de teclado (Ej: Ctrl+Shift+A)
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.shiftKey && e.key === 'A') { // Ctrl + Shift + A
                    e.preventDefault();
                    const password = prompt("Introduce la contrase√±a de administrador:");
                    if (password) {
                        showAdminPanel(password);
                    }
                }
            });
            // --- FIN de L√≥gica de Administraci√≥n Oculta ---

            // --- INICIALIZACI√ìN ---
            renderProductCards();
        });
    </script>
</body>
</html>




